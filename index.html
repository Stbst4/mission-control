<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tasks â€” Mission Control</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a href="index.html" class="nav-logo">ðŸ¦ž</a>
        <div class="nav-title">Mission Control</div>
      </div>
      <div class="nav-tabs">
        <a href="index.html" class="nav-tab active">Tasks</a>
        <a href="calendar.html" class="nav-tab">Calendar</a>
        <a href="memory.html" class="nav-tab">Memory</a>
        <a href="team.html" class="nav-tab">Team</a>
        <a href="office.html" class="nav-tab">Office</a>
      </div>
      <div class="nav-right">
        <div class="nav-status">
          <div class="nav-status-dot"></div>
          Online
        </div>
      </div>
    </nav>

    <div class="stats" id="stats"></div>
    <div class="filters" id="filters"></div>
    <div class="task-list" id="taskList"></div>
    <div class="updated-label" id="updatedLabel"></div>
  </div>

  <script>
    let allTasks = [];
    let activeFilter = 'all';

    async function loadTasks() {
      try {
        const res = await fetch('tasks.json?t=' + Date.now());
        const data = await res.json();
        allTasks = data.tasks;
        renderStats();
        renderFilters();
        renderTasks();
        document.getElementById('updatedLabel').textContent =
          'Updated ' + new Date(data.lastUpdated).toLocaleString();
      } catch(e) {
        document.getElementById('taskList').innerHTML = '<div class="empty-state">Failed to load tasks.</div>';
      }
    }

    function renderStats() {
      const total = allTasks.length;
      const active = allTasks.filter(t => t.status !== 'done').length;
      const blocked = allTasks.filter(t => t.status === 'blocked').length;
      const done = allTasks.filter(t => t.status === 'done').length;
      const shane = allTasks.filter(t => t.assignee === 'shane' && t.status !== 'done').length;
      const clawd = allTasks.filter(t => t.assignee === 'clawd' && t.status !== 'done').length;

      document.getElementById('stats').innerHTML = `
        <div class="stat-card"><div class="stat-label">Total</div><div class="stat-value">${total}</div></div>
        <div class="stat-card"><div class="stat-label">Active</div><div class="stat-value" style="color:var(--blue)">${active}</div></div>
        <div class="stat-card"><div class="stat-label">Blocked</div><div class="stat-value" style="color:var(--red)">${blocked}</div></div>
        <div class="stat-card"><div class="stat-label">Done</div><div class="stat-value" style="color:var(--green)">${done}</div></div>
        <div class="stat-card"><div class="stat-label">Shane</div><div class="stat-value" style="color:var(--yellow)">${shane}</div></div>
        <div class="stat-card"><div class="stat-label">Clawd</div><div class="stat-value" style="color:var(--blue)">${clawd}</div></div>
      `;
    }

    function renderFilters() {
      const filters = ['all','todo','in-progress','blocked','done','shane','clawd'];
      const labels = {all:'All',todo:'To Do','in-progress':'Active',blocked:'Blocked',done:'Done',shane:'Shane',clawd:'Clawd'};
      document.getElementById('filters').innerHTML = filters.map(f =>
        `<button class="filter-btn ${f===activeFilter?'active':''}" onclick="setFilter('${f}')">${labels[f]}</button>`
      ).join('');
    }

    function setFilter(f) { activeFilter = f; renderFilters(); renderTasks(); }

    function renderTasks() {
      let tasks = [...allTasks];
      if (['todo','in-progress','blocked','done'].includes(activeFilter))
        tasks = tasks.filter(t => t.status === activeFilter);
      else if (activeFilter === 'shane' || activeFilter === 'clawd')
        tasks = tasks.filter(t => t.assignee === activeFilter);

      const so = {blocked:0,'in-progress':1,todo:2,done:3};
      const po = {high:0,medium:1,low:2};
      tasks.sort((a,b) => (so[a.status]-so[b.status]) || (po[a.priority]-po[b.priority]));

      if (!tasks.length) {
        document.getElementById('taskList').innerHTML = '<div class="empty-state">No tasks match this filter.</div>';
        return;
      }

      const sl = s => ({todo:'To Do','in-progress':'In Progress',blocked:'Blocked',done:'Done'}[s]||s);

      document.getElementById('taskList').innerHTML = tasks.map(t => `
        <div class="task-row" onclick="this.classList.toggle('task-expanded')">
          <div class="priority-dot priority-${t.priority}"></div>
          <div class="task-info">
            <div class="task-title">${esc(t.title)}</div>
            <div class="task-desc">${esc(t.description)}</div>
            <div class="task-meta">
              ${t.dueDate ? 'Due: ' + t.dueDate + ' Â· ' : ''}
              ${t.blockedBy ? 'Blocked by: ' + t.blockedBy + ' Â· ' : ''}
              Created: ${t.created} Â· Updated: ${t.updated}
            </div>
          </div>
          <div class="task-pills">
            <span class="pill pill-${t.assignee}">${t.assignee}</span>
            <span class="pill pill-${t.category}">${t.category}</span>
            <span class="pill pill-${t.status}">${sl(t.status)}</span>
          </div>
        </div>
      `).join('');
    }

    function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
    loadTasks();
    setInterval(loadTasks, 60000);
  </script>
</body>
</html>
