<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Prospects ‚Äî Mission Control</title>
  <link rel="stylesheet" href="styles.css?v=ux20260221">
  <style>
    /* Prospect-specific styles */
    .prospect-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 14px 16px;
      margin-bottom: 4px;
      transition: all 0.15s;
      cursor: pointer;
    }
    .prospect-card:hover {
      border-color: var(--border-hover);
      background: var(--surface-2);
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(0,0,0,0.18);
    }

    .prospect-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 6px;
    }
    .prospect-name {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-bright);
      line-height: 1.3;
    }
    .prospect-pills { display: flex; gap: 4px; flex-shrink: 0; flex-wrap: wrap; justify-content: flex-end; }

    .prospect-address {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .prospect-contact-row {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      font-size: 11px;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }
    .prospect-contact-row span { display: flex; align-items: center; gap: 3px; }
    .prospect-contact-row .label { color: var(--text-dim); font-size: 10px; }

    .prospect-notes {
      font-size: 11px;
      color: var(--text-muted);
      font-style: italic;
      line-height: 1.4;
    }

    .prospect-lot {
      font-size: 10px;
      color: var(--text-secondary);
      background: var(--surface-3);
      padding: 2px 6px;
      border-radius: var(--radius-sm);
      white-space: nowrap;
    }

    /* Category pills */
    .pill-school { background: var(--blue-dim); color: var(--blue); }
    .pill-church { background: var(--violet-dim); color: var(--violet); }
    .pill-shopping { background: var(--yellow-dim); color: var(--yellow); }
    .pill-municipal { background: var(--green-dim); color: var(--green); }
    .pill-hoa { background: rgba(236,72,153,0.1); color: #ec4899; }
    .pill-property-mgmt { background: var(--red-dim); color: var(--red); }
    .pill-college { background: var(--blue-dim); color: var(--blue); }
    .pill-industrial { background: var(--surface-3); color: var(--text-secondary); }

    /* Priority dots */
    .priority-indicator {
      width: 4px;
      height: 100%;
      min-height: 40px;
      border-radius: 2px;
      flex-shrink: 0;
    }

    /* Status pills */
    .pill-new { background: var(--surface-3); color: var(--text-muted); }
    .pill-contacted { background: var(--blue-dim); color: var(--blue); }
    .pill-quoted { background: var(--yellow-dim); color: var(--yellow); }
    .pill-won { background: var(--green-dim); color: var(--green); }
    .pill-lost { background: var(--red-dim); color: var(--red); }

    /* Detail panel */
    .detail-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(8px);
      z-index: 100;
    }
    .detail-overlay.show { display: flex; align-items: center; justify-content: center; }
    .detail-panel {
      background: var(--surface-2);
      border: 1px solid var(--border-hover);
      border-radius: var(--radius-lg);
      padding: 20px;
      max-width: 520px;
      width: 90%;
      position: relative;
      max-height: 80vh;
      overflow-y: auto;
    }
    .detail-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-bright);
      margin-bottom: 4px;
      padding-right: 30px;
    }
    .detail-address {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 14px;
    }
    .detail-section {
      margin-bottom: 14px;
    }
    .detail-section-title {
      font-size: 10px;
      font-weight: 600;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin-bottom: 6px;
    }
    .detail-field {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid var(--border);
      font-size: 12px;
    }
    .detail-field:last-child { border-bottom: none; }
    .detail-label { color: var(--text-muted); }
    .detail-value { color: var(--text); font-weight: 500; text-align: right; }
    .detail-value a { color: var(--blue); text-decoration: none; }
    .detail-value a:hover { text-decoration: underline; }
    .detail-notes-text {
      font-size: 12px;
      color: var(--text-secondary);
      line-height: 1.5;
    }
    .detail-close {
      position: absolute;
      top: 14px; right: 14px;
      background: none; border: none;
      color: var(--text-muted);
      font-size: 18px;
      cursor: pointer;
      transition: color 0.15s;
    }
    .detail-close:hover { color: var(--text); }

    .detail-actions {
      display: flex;
      gap: 6px;
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }
    .detail-btn {
      padding: 6px 14px;
      font-size: 11px;
      font-weight: 500;
      font-family: inherit;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: var(--surface);
      color: var(--text);
      cursor: pointer;
      transition: all 0.15s;
    }
    .detail-btn:hover { border-color: var(--border-hover); background: var(--surface-3); }
    .detail-btn.primary { background: var(--blue); border-color: var(--blue); color: #fff; }
    .detail-btn.primary:hover { opacity: 0.9; }

    /* Has-contact indicators */
    .contact-icon { font-size: 10px; opacity: 0.5; }
    .contact-icon.has { opacity: 1; }

    @media (max-width: 768px) {
      .prospect-header { flex-direction: column; gap: 6px; }
      .prospect-pills { justify-content: flex-start; }
      .prospect-contact-row { flex-direction: column; gap: 4px; }
      .detail-panel { padding: 16px; max-width: 95%; }
    }
  </style>
</head>
<body>
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a href="index.html" class="nav-logo">ü¶û</a>
        <div class="nav-title">Mission Control</div>
      </div>
      <div class="nav-tabs">
        <a href="index.html" class="nav-tab">Tasks</a>
        <a href="agents.html" class="nav-tab">Agents</a>
        <a href="calendar.html" class="nav-tab">Calendar</a>
        <a href="prospects.html" class="nav-tab active">Prospects</a>
        <a href="memory.html" class="nav-tab">Memory</a>
        <a href="team.html" class="nav-tab">Team</a>
      </div>
      <div class="nav-right">
        <div class="nav-status">
          <div class="nav-status-dot"></div>
          Online
        </div>
      </div>
    </nav>

    <section class="panel hero-panel">
      <div>
        <div class="section-label">Sales Pipeline</div>
        <h1 class="hero-title">Prospects</h1>
        <p class="hero-subtitle">25 verified leads within 20mi of Latrobe ‚Äî malls, hospitals, schools, churches, industrial.</p>
      </div>
      <div class="hero-meta" id="updatedLabel">Loading‚Ä¶</div>
    </section>

    <div class="stats" id="stats"></div>

    <section class="panel controls-panel">
      <div class="search-wrap">
        <span class="search-icon">‚åï</span>
        <input id="prospectSearch" class="search-input" type="text" placeholder="Search prospects, contacts, addresses‚Ä¶ (press /)">
      </div>
      <div class="controls-row">
        <div class="filters" id="categoryFilters"></div>
        <div class="sort-wrap">
          <label for="sortMode" class="sort-label">Sort</label>
          <select id="sortMode" class="sort-select">
            <option value="priority">Priority</option>
            <option value="name">Name</option>
            <option value="category">Category</option>
            <option value="lotSize">Lot Size</option>
          </select>
        </div>
      </div>
      <div class="filters" id="statusFilters" style="margin-top:8px;"></div>
    </section>

    <div id="prospectList"></div>
  </div>

  <!-- Detail Panel -->
  <div class="detail-overlay" id="detailOverlay">
    <div class="detail-panel" id="detailPanel"></div>
  </div>

  <script>
    let allProspects = [];
    let activeCategory = 'all';
    let activeStatus = 'all';
    let query = '';
    let sortMode = 'priority';

    const categoryPillClass = {
      'School District': 'pill-school',
      'Church': 'pill-church',
      'Shopping Center': 'pill-shopping',
      'Municipal': 'pill-municipal',
      'HOA': 'pill-hoa',
      'Property Management': 'pill-property-mgmt',
      'College': 'pill-college',
      'Industrial': 'pill-industrial',
    };

    const statusPillClass = {
      'new': 'pill-new',
      'contacted': 'pill-contacted',
      'quoted': 'pill-quoted',
      'won': 'pill-won',
      'lost': 'pill-lost',
    };

    const lotSizeOrder = { 'Very Large': 0, 'Large': 1, 'Multiple Properties': 1, 'Medium': 2, 'Medium-Large': 2, 'Small-Medium': 3, 'Small': 4 };
    const priorityOrder = { 'high': 0, 'medium': 1, 'low': 2 };

    async function loadProspects() {
      try {
        const res = await fetch('prospects.json?t=' + Date.now());
        const data = await res.json();
        allProspects = data.prospects || [];
        renderStats();
        renderCategoryFilters();
        renderStatusFilters();
        renderProspects();
        document.getElementById('updatedLabel').textContent =
          'Updated ' + new Date(data.lastUpdated).toLocaleString();
      } catch (e) {
        document.getElementById('prospectList').innerHTML =
          '<div class="empty-state">Failed to load prospects.</div>';
      }
    }

    function renderStats() {
      const total = allProspects.length;
      const highPriority = allProspects.filter(p => p.priority === 'high').length;
      const withEmail = allProspects.filter(p => p.email).length;
      const withContact = allProspects.filter(p => p.contact).length;
      const categories = new Set(allProspects.map(p => p.category)).size;
      const contacted = allProspects.filter(p => p.status !== 'new').length;

      document.getElementById('stats').innerHTML = `
        <div class="stat-card"><div class="stat-label">Total</div><div class="stat-value">${total}</div></div>
        <div class="stat-card"><div class="stat-label">High Priority</div><div class="stat-value">${highPriority}</div></div>
        <div class="stat-card"><div class="stat-label">Has Email</div><div class="stat-value">${withEmail}</div></div>
        <div class="stat-card"><div class="stat-label">Has Contact</div><div class="stat-value">${withContact}</div></div>
        <div class="stat-card"><div class="stat-label">Categories</div><div class="stat-value">${categories}</div></div>
        <div class="stat-card"><div class="stat-label">Contacted</div><div class="stat-value">${contacted}</div></div>
      `;
    }

    function renderCategoryFilters() {
      const cats = {};
      allProspects.forEach(p => { cats[p.category] = (cats[p.category] || 0) + 1; });
      let html = `<button class="filter-btn ${activeCategory === 'all' ? 'active' : ''}" onclick="setCategory('all')">All <span class="filter-count">${allProspects.length}</span></button>`;
      Object.entries(cats).sort((a, b) => b[1] - a[1]).forEach(([cat, count]) => {
        html += `<button class="filter-btn ${activeCategory === cat ? 'active' : ''}" onclick="setCategory('${cat}')">${cat} <span class="filter-count">${count}</span></button>`;
      });
      document.getElementById('categoryFilters').innerHTML = html;
    }

    function renderStatusFilters() {
      const statuses = { 'new': 0, 'contacted': 0, 'quoted': 0, 'won': 0, 'lost': 0 };
      allProspects.forEach(p => { statuses[p.status] = (statuses[p.status] || 0) + 1; });
      let html = `<button class="filter-btn ${activeStatus === 'all' ? 'active' : ''}" onclick="setStatus('all')">All Status</button>`;
      Object.entries(statuses).forEach(([status, count]) => {
        if (count > 0 || status === 'new') {
          html += `<button class="filter-btn ${activeStatus === status ? 'active' : ''}" onclick="setStatus('${status}')">${status.charAt(0).toUpperCase() + status.slice(1)} <span class="filter-count">${count}</span></button>`;
        }
      });
      document.getElementById('statusFilters').innerHTML = html;
    }

    function setCategory(cat) { activeCategory = cat; renderCategoryFilters(); renderProspects(); }
    function setStatus(s) { activeStatus = s; renderStatusFilters(); renderProspects(); }

    function getFiltered() {
      let list = [...allProspects];
      if (activeCategory !== 'all') list = list.filter(p => p.category === activeCategory);
      if (activeStatus !== 'all') list = list.filter(p => p.status === activeStatus);
      if (query) {
        const q = query.toLowerCase();
        list = list.filter(p =>
          p.name.toLowerCase().includes(q) ||
          (p.contact && p.contact.toLowerCase().includes(q)) ||
          p.address.toLowerCase().includes(q) ||
          (p.notes && p.notes.toLowerCase().includes(q)) ||
          p.category.toLowerCase().includes(q)
        );
      }
      // Sort
      list.sort((a, b) => {
        if (sortMode === 'priority') return (priorityOrder[a.priority] ?? 2) - (priorityOrder[b.priority] ?? 2);
        if (sortMode === 'name') return a.name.localeCompare(b.name);
        if (sortMode === 'category') return a.category.localeCompare(b.category) || a.name.localeCompare(b.name);
        if (sortMode === 'lotSize') return (lotSizeOrder[a.lotSize] ?? 3) - (lotSizeOrder[b.lotSize] ?? 3);
        return 0;
      });
      return list;
    }

    function renderProspects() {
      const list = getFiltered();
      if (!list.length) {
        document.getElementById('prospectList').innerHTML = '<div class="empty-state">No prospects match your filters.</div>';
        return;
      }
      let html = '';
      list.forEach(p => {
        const catClass = categoryPillClass[p.category] || 'pill-todo';
        const statusClass = statusPillClass[p.status] || 'pill-new';
        const contactLine = [];
        if (p.contact) contactLine.push(`<span>üë§ ${esc(p.contact)}${p.contactTitle ? ' ‚Äî ' + esc(p.contactTitle) : ''}</span>`);
        else if (p.contactTitle) contactLine.push(`<span>üë§ ${esc(p.contactTitle)}</span>`);
        if (p.phone) contactLine.push(`<span>üìû ${esc(p.phone)}</span>`);
        if (p.email) contactLine.push(`<span>‚úâÔ∏è ${esc(p.email)}</span>`);

        html += `
          <div class="prospect-card" onclick="showDetail('${p.id}')">
            <div class="prospect-header">
              <div>
                <div class="prospect-name">${esc(p.name)}</div>
                <div class="prospect-address">üìç ${esc(p.address)}</div>
              </div>
              <div class="prospect-pills">
                <span class="pill ${catClass}">${esc(p.category)}</span>
                <span class="prospect-lot">${esc(p.lotSize)}</span>
                <span class="pill ${statusClass}">${p.status.toUpperCase()}</span>
              </div>
            </div>
            ${contactLine.length ? `<div class="prospect-contact-row">${contactLine.join('')}</div>` : ''}
            ${p.notes ? `<div class="prospect-notes">${esc(p.notes)}</div>` : ''}
          </div>`;
      });
      document.getElementById('prospectList').innerHTML = html;
    }

    function showDetail(id) {
      const p = allProspects.find(x => x.id === id);
      if (!p) return;
      const catClass = categoryPillClass[p.category] || 'pill-todo';

      document.getElementById('detailPanel').innerHTML = `
        <button class="detail-close" onclick="closeDetail()">‚úï</button>
        <div class="detail-title">${esc(p.name)}</div>
        <div class="detail-address">üìç ${esc(p.address)}</div>
        <div style="display:flex;gap:4px;margin-bottom:14px;">
          <span class="pill ${catClass}">${esc(p.category)}</span>
          <span class="prospect-lot">${esc(p.lotSize)}</span>
          <span class="pill priority-pill-${p.priority}">${p.priority.toUpperCase()} PRIORITY</span>
        </div>

        <div class="detail-section">
          <div class="detail-section-title">Contact Info</div>
          <div class="detail-field"><span class="detail-label">Contact</span><span class="detail-value">${p.contact ? esc(p.contact) : '‚Äî'}</span></div>
          <div class="detail-field"><span class="detail-label">Title</span><span class="detail-value">${p.contactTitle ? esc(p.contactTitle) : '‚Äî'}</span></div>
          <div class="detail-field"><span class="detail-label">Phone</span><span class="detail-value">${p.phone ? `<a href="tel:${p.phone}">${esc(p.phone)}</a>` : '‚Äî'}</span></div>
          <div class="detail-field"><span class="detail-label">Email</span><span class="detail-value">${p.email ? `<a href="mailto:${p.email}">${esc(p.email)}</a>` : '‚Äî'}</span></div>
          <div class="detail-field"><span class="detail-label">Website</span><span class="detail-value">${p.website ? `<a href="https://${p.website}" target="_blank">${esc(p.website)}</a>` : '‚Äî'}</span></div>
        </div>

        ${p.notes ? `
        <div class="detail-section">
          <div class="detail-section-title">Notes</div>
          <div class="detail-notes-text">${esc(p.notes)}</div>
        </div>` : ''}

        <div class="detail-section">
          <div class="detail-section-title">Status</div>
          <div class="detail-field">
            <span class="detail-label">Current</span>
            <select class="sort-select" onchange="updateStatus('${p.id}', this.value)" style="font-size:11px;">
              ${['new','contacted','quoted','won','lost'].map(s =>
                `<option value="${s}" ${p.status === s ? 'selected' : ''}>${s.charAt(0).toUpperCase() + s.slice(1)}</option>`
              ).join('')}
            </select>
          </div>
          <div class="detail-field">
            <span class="detail-label">Priority</span>
            <select class="sort-select" onchange="updatePriority('${p.id}', this.value)" style="font-size:11px;">
              ${['high','medium','low'].map(pr =>
                `<option value="${pr}" ${p.priority === pr ? 'selected' : ''}>${pr.charAt(0).toUpperCase() + pr.slice(1)}</option>`
              ).join('')}
            </select>
          </div>
          <div class="detail-field"><span class="detail-label">Source</span><span class="detail-value">${p.source || 'AI Prospector'}</span></div>
        </div>
      `;
      document.getElementById('detailOverlay').classList.add('show');
    }

    function closeDetail() {
      document.getElementById('detailOverlay').classList.remove('show');
    }

    function updateStatus(id, newStatus) {
      const p = allProspects.find(x => x.id === id);
      if (p) { p.status = newStatus; renderStats(); renderStatusFilters(); renderProspects(); }
    }

    function updatePriority(id, newPriority) {
      const p = allProspects.find(x => x.id === id);
      if (p) { p.priority = newPriority; renderStats(); renderProspects(); }
    }

    function esc(s) {
      if (!s) return '';
      const d = document.createElement('div');
      d.textContent = s;
      return d.innerHTML;
    }

    // Search
    const searchInput = document.getElementById('prospectSearch');
    searchInput.addEventListener('input', e => { query = e.target.value; renderProspects(); });
    document.addEventListener('keydown', e => {
      if (e.key === '/' && document.activeElement !== searchInput) { e.preventDefault(); searchInput.focus(); }
      if (e.key === 'Escape') { closeDetail(); searchInput.blur(); }
    });

    // Sort
    document.getElementById('sortMode').addEventListener('change', e => { sortMode = e.target.value; renderProspects(); });

    // Click outside detail panel to close
    document.getElementById('detailOverlay').addEventListener('click', e => {
      if (e.target === document.getElementById('detailOverlay')) closeDetail();
    });

    // Priority pill inline style
    const style = document.createElement('style');
    style.textContent = `
      .priority-pill-high { background: var(--red-dim); color: var(--red); }
      .priority-pill-medium { background: var(--yellow-dim); color: var(--yellow); }
      .priority-pill-low { background: var(--blue-dim); color: var(--blue); }
    `;
    document.head.appendChild(style);

    loadProspects();
  </script>
</body>
</html>
